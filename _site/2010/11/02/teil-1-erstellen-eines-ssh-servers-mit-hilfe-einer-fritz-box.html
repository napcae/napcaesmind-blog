<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Chi Trung Nguyen &middot; Teil 1: Erstellen eines SSH Servers mit Hilfe einer Fritz!Box</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Chi Trung Nguyen's personal Blog and public website">
<meta name="author" content="Chi Trung Nguyen">
<meta name="detectify-verification" content="d21bebd409c2491d5c0f47947d652de2" />
<meta name="google-site-verification" content="dFScXo-E3sdI3dKv9vTkMqUy7gZwlY3KxAlmUpnj644" />
<link href="/assets/css/bootstrap.min.css" rel="stylesheet">
<!--Google Analytics
<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-28275669-1']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>-->
<script type="text/javascript">
var clicky_site_ids = clicky_site_ids || [];
clicky_site_ids.push(100700869);
(function() {
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = '//static.getclicky.com/js';
  ( document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0] ).appendChild( s );
})();
</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/100700869ns.gif" /></p></noscript>
<script src="/assets/js/jquery-2.0.2.min.js"></script>
<script src="/assets/js/bootstrap.min.js"></script>
<script src="/assets/js/list.min.js"></script>
<style type="text/css">
body {
padding-top: 20px;
padding-bottom: 40px;
}
.container-main {
max-width: 900px;
padding:0 19px;
margin: 0 auto;
}
.container-main > hr {
margin: 30px 0;
}
.elastic-video {
position: relative;
padding-bottom: 55%;
padding-top: 15px;
height: 0;
overflow: hidden;
}
.elastic-video iframe {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
}
.left-inner-addon {
position: relative;
}
.left-inner-addon input {
padding-left: 30px;    
}
.left-inner-addon i {
position: absolute;
padding: 10px 12px;
pointer-events: none;
}
.right-inner-addon {
position: relative;
}
.right-inner-addon input {
padding-right: 30px;    
}
.right-inner-addon i {
position: absolute;
right: 0px;
padding: 10px 12px;
pointer-events: none;
}
</style>
</head>
<body>
<div class="container-main">
<div class="header">
<div class="navbar navbar-default" role="navigation">
<!-- Brand and toggle get grouped for better mobile display -->
<div class="navbar-header">
<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a class="navbar-brand" href="/">Chi Trung Nguyen</a>
</div>
<!-- Collect the nav links, forms, and other content for toggling -->
<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
<ul class="nav navbar-nav navbar-right">

<li><a href="/blog">Blog</a></li>

</ul>
</div><!-- /.navbar-collapse -->
</div ><!-- navbar navbar-default -->
</div>
<hr>

       Published on <p class="meta">02 Nov 2010</p>
<h2>Teil 1: Erstellen eines SSH Servers mit Hilfe einer Fritz!Box</h2>


<div class="post" >
<p>Fangen wir also an!</p>

<p>Benötigt wird eine Fritz!Box, in diesem Fall eine 7170.</p>

<p>Installiert wird dann <a href="http://matt.ucc.asn.au/dropbear/dropbear.html" target="_blank">Dropbear</a>, ein SSH Server, der speziell für <a href="http://de.wikipedia.org/wiki/Embedded_Linux" target="_blank">eingebettete Pinguine</a> entwickelt wurde.</p>

<h2><span style="font-size:20px;">Dropbear installieren</span><span style="font-size:20px;font-weight:bold;"></span></h2>

<p>Schafft euch erst mal Zugriff zu eurer Box via telnet. Nehmt dazu ein Telefon im Haushalt und ruft folgende Nummer an:</p>

<pre><code>#96*7*
</code></pre>

<p>Jetzt kann man sich über eine Shell auf die Box verbinden. Das Passwort ist dabei das gleiche, wie beim Webfrontend</p>

<pre><code>telnet fritz.box
</code></pre>

<p>Dropbear wird nun installiert, kopiert den Hash eures selbst gewählten Passwortes</p>

<pre><code>$ cd /var
$ /usr/bin/wget http://www.spblinux.de/fbox.new/cfg_dropbear
$ chmod 755 /var/cfg_dropbear
$ /var/cfg_dropbear install
$ /var/dropbear/bin/passwd
$ cat /var/tmp/passwd&lt;/pre&gt;
</code></pre>

<p>Als nächstes öffnet <a href="http://de.wikipedia.org/wiki/Vi" target="_blank">vi</a> um eine neue Datei zu erstellen</p>

<pre><code>vi /var/tmp/debug.cfg
</code></pre>

<p>Kopiert den Inhalt hier in das Script, xxxxxxxx müsst ihr mit dem errechneten Hashwert ersetzen</p>

<pre><code>#!/bin/sh
while !(ping -c 1 spblinux.de)
do
sleep 2
done
cd /var
/usr/bin/wget http://www.spblinux.de/fbox.new/cfg_dropbear
sleep 10
chmod 755 /var/cfg_dropbear
/var/cfg_dropbear install
/var/cfg_dropbear start
/var/dropbear/bin/dropbearkey -t rsa -f /var/tmp/dropbear_rsa_hostkey -s 768
echo 'root:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx:0:0:root:/var/tmp/:/bin/sh' &gt; /var/tmp/passwd
echo "ftpuser:any:1000:0:ftp user:/var/media/ftp:/bin/sh" &gt;&gt; /var/tmp/passwd
echo "nameserver 192.168.178.1" &gt;&gt; /var/tmp/resolv.conf
</code></pre>

<p>Das erstellte Script wird dann mit ESC , <strong>:wq</strong> gespeichert und mit</p>

<pre><code>$ cat /var/tmp/debug.cfg &gt; /var/flash/debug.cfg
</code></pre>

<p>in den Speicher geschrieben.</p>

<h2>ar7.cfg bearbeiten</h2>

<p>Die ar7.cfg wird nun bearbeitet, um die Fritz!Box von außen erreichbar zu machen.</p>

<pre><code>$ cat /var/flash/ar7.cfg &gt; /var/tmp/ar7.cfg
$ vi /var/tmp/ar7.cfg
</code></pre>

<p>Sucht nach diesen Zeilen und fügt <strong>#ssh-fritz-box</strong> hinzu</p>

<pre><code>forwardrules = "tcp 0.0.0.0:584 0.0.0.0:443 0",
                "tcp 0.0.0.0:443 0.0.0.0:22 # fritz-box"
</code></pre>

<p>Es wird der Port 443 verwendet(https). Damit “sichert” man sich vor Bruteforceattacken insofern ab, dass der Standard Port für ssh eigentlich 22 ist. Der Hauptgrund aber warum nicht der Port 22 benutzt wird, ist dass die meisten (Schul-,Firmen-)Netzwerke diesen sperren, 443 aber hingegen durchlassen.</p>

<p>Die temporäre Datei wird wieder in den Speicher geschrieben</p>

<pre><code>$ cat /var/tmp/ar7.cfg &gt; /var/flash/ar7.cfg
</code></pre>

<p>Zum Schluss wird die Box neu gestartet</p>

<pre><code>$ reboot
</code></pre>

<p>und Telnet wieder abgeschaltet, in dem man mit dem Telefon diese Nummer anruft:</p>

<pre><code>#96*8*
</code></pre>

<p><a href="/blog/2010/11/teil-2-erstellen-des-socks5-proxys">Der zweite Teil, das erstellen des SOCKS5 Proxys</a> und der <a href="/blog/2010/11/teil-3-optimierung" target="_blank">dritte Teil, die Optimierung</a> folgen noch.</p>

</div>

<hr>
<!-- Disqus-->
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'napcaesmind'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<!-- Disqus end -->

<hr>
<div class="footer">
<div class="row-fluid">
<div class="span12"><p>
<a href="http://www.ctnguyen.net">Chi Trung Nguyen</a> 2009 - 2015
&middot; <a href="/about">About</a>
&middot; <a href="/report">Report Incident</a>
&middot; <a href="/archive">Archive</a> &middot;
<a href="blog/feed.xml"><img alt="feed" width="16" src="/assets/img/rss.png">  RSS</a>
</div>
<div class="span12" style="text-align:center;"><!--
<a href="https://www.digitalocean.com/?refcode=4e7c40a32a7a"><img width="140" src="/assets/img/digitalocean-badge-blue.png"></a> !-->
</div>
</div>
<!-- row fluid -->
</div>
<!-- /footer -->
</div>
<!-- /container -->
</body>
</html>

